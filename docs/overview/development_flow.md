---
id: development_flow
title: "Commit Coach 開発フロー – モノレポ構成 (Next.js + Express)"
description: "フロントエンド (Next.js + TypeScript + Tailwind CSS) とバックエンド (Express + TypeScript + Supabase) の開発ロードマップと詳細チェックリスト"
version: "6.0"
last_updated: "2025-04-27"
owner: "nakazawatarou"
stakeholders: ["dev_team", "ai_assistant"]
---

# 開発フロー

## 1. プロジェクト構造の整理
- [x] モノレポ構成の初期化
- [x] 開発環境のセットアップ
- [x] CI/CDパイプラインの準備
- [ ] フロントエンドの基盤構築
- [ ] バックエンドの基盤構築

## 2. フロントエンド再構築
### ダッシュボードの実装
- [ ] レイアウト設計
- [ ] データ表示
- [ ] インタラクション
- [ ] レスポンシブ対応

### プロジェクト管理機能の実装
- [ ] プロジェクト一覧
- [ ] プロジェクト作成/編集
- [ ] プロジェクト詳細
- [ ] プロジェクト設定

### タスク管理機能の実装
- [ ] タスク一覧
- [ ] タスク作成/編集
- [ ] タスク詳細
- [ ] タスクフィルター

### UIコンポーネントの実装
- [ ] 共通コンポーネント
- [ ] フォームコンポーネント
- [ ] モーダルコンポーネント
- [ ] アニメーション

### 認証フローの実装
- [ ] ログイン/ログアウト機能
- [ ] ユーザー登録機能
- [x] パスワードリセット機能
- [ ] セッション管理

## 3. バックエンド再構築
### APIエンドポイントの設計
- [ ] 認証API
- [ ] プロジェクトAPI
- [ ] タスクAPI
- [ ] ユーザーAPI

### データベーススキーマの設計
- [ ] ユーザーテーブル
- [ ] プロジェクトテーブル
- [ ] タスクテーブル
- [ ] リレーション

### 認証システムの実装
- [ ] JWT認証
- [ ] セッション管理
- [ ] パスワードハッシュ
- [ ] アクセス制御

### プロジェクト管理APIの実装
- [ ] CRUD操作
- [ ] バリデーション
- [ ] エラーハンドリング
- [ ] ログ記録

### タスク管理APIの実装
- [ ] CRUD操作
- [ ] バリデーション
- [ ] エラーハンドリング
- [ ] ログ記録

## 4. テスト
### ユニットテストの実装
- [ ] フロントエンドコンポーネント
- [ ] バックエンドAPI
- [ ] ユーティリティ関数
- [ ] バリデーション

### 統合テストの実装
- [ ] フロントエンド・バックエンド連携
- [ ] データフロー
- [ ] エラーハンドリング
- [ ] パフォーマンス

### パフォーマンステストの実装
- [ ] ロードテスト
- [ ] ストレステスト
- [ ] スケーラビリティテスト
- [ ] ベンチマーク

### セキュリティテストの実装
- [ ] 認証/認可
- [ ] データ保護
- [ ] 脆弱性スキャン
- [ ] ペネトレーションテスト

## 5. デプロイメント
### ステージング環境の構築
- [ ] 環境設定
- [ ] デプロイパイプライン
- [ ] モニタリング
- [ ] ログ管理

### 本番環境の構築
- [ ] 環境設定
- [ ] デプロイパイプライン
- [ ] モニタリング
- [ ] ログ管理

### モニタリングシステムの構築
- [ ] アプリケーションモニタリング
- [ ] インフラモニタリング
- [ ] アラート設定
- [ ] ダッシュボード

### ログ管理システムの構築
- [ ] ログ収集
- [ ] ログ分析
- [ ] アラート設定
- [ ] ダッシュボード

## 6. ドキュメント
### アーキテクチャ設計書の作成
- [ ] システム概要
- [ ] コンポーネント図
- [ ] シーケンス図
- [ ] データフロー

### API仕様書の作成
- [ ] エンドポイント一覧
- [ ] リクエスト/レスポンス
- [ ] エラーコード
- [ ] サンプルコード

### ユーザーマニュアルの作成
- [ ] 機能説明
- [ ] 操作手順
- [ ] トラブルシューティング
- [ ] FAQ

### 開発者ガイドの作成
- [ ] 開発環境構築
- [ ] コーディング規約
- [ ] デプロイ手順
- [ ] トラブルシューティング

## 7. テスト駆動開発(TDD)ガイドライン

### 基本フロー
1. 失敗するテストを書く（Red）
2. テストを通す最小コードを書く（Green）
3. コードをリファクタリング（Refactor）

### 推奨プラクティス
- テスト名は「should ... when ...」形式で
- 1テストケース=1アサーション
- モックデータは__mocks__ディレクトリで管理

### カバレッジ目標
- コンポーネント: 80%+
- フック: 90%+
- API連携: 70%+

## 🛠️ 技術的負債・暫定対応メモ
- [ ] SupabaseのURL/KEYは現状AuthProvider.tsxにベタ打ち。ポートフォリオ・検証用の暫定対応。
- [ ] 本番・公開前に必ず.env.local（または.env）で `NEXT_PUBLIC_SUPABASE_URL` `NEXT_PUBLIC_SUPABASE_ANON_KEY` として環境変数管理に修正すること。

---

# 開発フロー – 概要とチェックリスト

このドキュメントは **モノレポ構成 (Next.js + Express)** の開発フローを定義します。AIアシスタントとの協業を前提とした効率的な開発プロセスを採用しています。

> **関連ドキュメント**
> - [AIアクターの役割とロードマップ](./roles_and_roadmap.md) - AIアシスタント（o3, cursor, windsurf）の役割分担と協業ルール
> - [アーキテクチャ仕様](./architecture.spec.md) - システムの技術設計と実装方針
> - [作業メモ帳](../../skratchpad.md) - 短期の作業記録と進捗管理

---

## 1. 進捗サマリ（毎週更新）
| レイヤ | 完了 | 直近 TODO |
|--------|------|-------------|
| **共通基盤** | Step 0‑9 完了 (除Step 14) | Step 14: DevContainer設定 (任意) |
| **Frontend** | Step 21-29, 31-36, 38 完了 | Step 30, 37, 39-40: テストとアニメーション |
| **Backend** | Step 101‑180, 186 完了 | Step 181‑185: Docker & Fly.io セットアップ |
| **品質/CI** | lint ✅ | unit/E2E テスト → CI グリーン化 |
| **デプロイ** | 未着手 | Step 181‑190: Docker & Fly.io |

> **更新方法**: Step を達成したらPRで該当行を `[x]` に変更し、末尾に `(#PR番号)` を追記してください。

---

## 2. 作業フェーズ概要
### 2.1 共通基盤 (Step 0‑20)
モノレポ雛形・共有ツール・CI を整える段階。

### 2.2 フロントエンド (Step 21‑100)
認証 → ダッシュボード → Kanban & AI チャット → 品質・デプロイの 4 フェーズ。

### 2.3 バックエンド (Step 101‑200)
初期化 → DB/RLS → ルーティング&認証 → CRUD+AI → テスト → デプロイ → 運用。

---

## 3. 付録 A — **200 Step チェックリスト**
<details><summary>クリックして展開</summary>

```markdown
### 共通基盤 (0‑20)
- [x] **0**  Node.js 20.x & pnpm 9 インストール
- [x] **1**  `pnpm init` – ルート workspace package.json 生成
- [x] **2**  共有ツール (eslint, prettier, husky, lint‑staged) 導入
- [x] **3**  `pnpm dlx create-next-app` → apps/frontend 初期化
- [x] **4**  `pnpm create @express/api` → apps/backend 初期化
- [x] **5**  packages/shared-types で Zod スキーマ & tsup 設定
- [x] **6**  `pnpm-workspace.yaml` に apps/* & packages/* を登録
- [x] **7**  ルート ESLint / Prettier / CursorRules 設定
- [x] **8**  Husky & lint‑staged (`pre-commit`: fmt+lint)
- [x] **9**  GitHub Actions: install → lint → test ワークフロー
- [x] **10** 初回コミット `feat: bootstrap monorepo`
- [x] **11** apps/frontend `tsconfig.json` 調整
- [x] **12** Tailwind `tailwind.config.js` カスタムテーマ
- [x] **13** VSCode workspace 設定
- [ ] **14** DevContainer / Docker 開発環境 (任意)
- [x] **15** Conventional Commits チェック (commitlint)
- [x] **16** Dependabot / Renovate 設定
- [x] **17** `.editorconfig` 追加
- [x] **18** Issue & PR テンプレ作成
- [x] **19** CODEOWNERS 追加
- [x] **20** GitHub Discussions / Wiki 有効化

### フロントエンド (21‑100)
#### 3.1 認証 & ダッシュボード (21‑40)
- [x] **21** `/login` ページ – Email/PW フォーム (2025-05-04)
- [x] **22** `useAuth` Context (Supabase) (2025-05-04)
- [x] **23** JWT を Cookie 保存 (2025-05-04)
- [x] **24** `/logout` 処理 (2025-05-04)
- [x] **25** 認証ガード (Next.js middleware) (2025-05-04)
- [x] **26** `/register` & `/password/reset` ページ (2025-05-04)
- [x] **27** react-hook‑form + zod バリデーション (2025-05-04)
- [x] **28** ローディング & エラーメッセージ (2025-05-04)
- [x] **29** commit `feat(frontend): auth flow` (2025-05-04)
- [x] **30** RTL ユニットテスト(Auth) (2025-04-30)
- [x] **31** `/dashboard` 骨格 (2025-04-28)
- [x] **32** AIチャットプレースホルダ (2025-05-04)
- [x] **33** 今日のタスク / 期限間近カード (2025-05-04)
- [x] **34** 時計 & mini‑calendar (2025-05-04)
- [ ] **35** レスポンシブ調整 (2025-04-28)
- [ ] **36** モックデータ (SWR) (2025-04-28)
- [ ] **37** UI アニメーション (2025-04-28)
- [ ] **38** commit `feat(frontend): dashboard` (2025-04-28)
- [ ] **39** ダッシュボードユニットテスト
- [ ] **40** コンポーネントユニットテスト

#### 3.2 Kanban & リファクタ (41‑60)
- [ ] **41** ダッシュボードコンポーネント分割 (2025-04-28)
- [ ] **42** `useTaskManagement` / `useDragAndDrop` hooks (2025-04-28)
- [ ] **43** 型定義強化 (Task, Project) (2025-04-28)
- [ ] **44** RTL + Cypress テスト追加
- [ ] **45** commit `refactor(frontend): split dashboard`
- [ ] **46** `/projects` 一覧 UI (2025-04-28)
- [ ] **47** 検索 & フィルタ (2025-04-28)
- [ ] **48** ページネーション / 無限スクロール (2025-04-28)
- [ ] **49** プロジェクト詳細 `/projects/[id]` (2025-04-28)
- [ ] **50** 詳細画面骨格 (2025-04-29)
- [ ] **51** カンバンコンテナ (2025-04-29)
- [ ] **52** **dnd‑kit** 実装 (列/カード DnD) (2025-04-29)
- [ ] **53** タスク詳細モーダル (2025-04-29)
- [ ] **54** サブタスク折りたたみ (2025-04-29)
- [ ] **55** 期限・完了 UI (2025-04-29)
- [ ] **56** AI「タスク分解」ボタン(モック)
- [ ] **57** 期限切れスタイル (2025-04-29)
- [ ] **58** API モック → 本 API 切替 (2025-04-29)
- [ ] **59** commit `feat(frontend): kanban` (2025-04-29)
- [ ] **60** レスポンシブ & ユニットテスト最終
- [x] **60.1** パスエイリアス問題の修正（全ファイル・2025-05-03実装）
- [ ] **60.2** プロジェクト詳細ページの修正
- [x] **60.3** データ連携の完全実装（2025-05-03 useProjectsとuseProjectTasksフックのSupabase連携実装）
- [ ] **60.4** 切れているリンク・画面の修正

#### 3.3 AIチャット & 設定 (61‑80)
- [ ] **61** サイドチャット UI
- [ ] **62** メッセージ送信即時描画
- [ ] **63** システムメッセージ表示
- [ ] **64** OpenAI 応答 (モック→実装)
- [ ] **65** モード切替タブ
- [ ] **66** 音声入力(将来)
- [ ] **67** 仮想リスト
- [ ] **68** `/api/v1/ai/coach` 接続
- [ ] **69** commit `feat(frontend): ai chat`
- [ ] **70** localStorage ログ保存

#### 3.4 品質 & デプロイ (81‑100)
- [ ] **81** Jest 単体テスト >80%
- [ ] **82** スナップショットテスト
- [ ] **83** フォーム異常値テスト
- [ ] **84** Cypress E2E (auth→dashboard)
- [ ] **85** Percy Visual diff
- [ ] **86** モバイルレスポンシブ shot
- [ ] **87** GitHub Actions CI 緑化
- [ ] **88** commit `test(frontend): coverage`
- [ ] **89** Lint/型エラーゼロ
- [ ] **90** Storybook ドキュメント
- [ ] **91** `next build` 確認
- [ ] **92** Vercel プロジェクト作成
- [ ] **93** `.env.production` 整備
- [ ] **94** 初回デプロイ
- [ ] **95** ダークモード最終
- [ ] **96** a11y (aria‑label)
- [ ] **97** Vercel 自動デプロイ GitHub Actions
- [ ] **98** commit `build(frontend): production ready`
- [ ] **99** バグ修正／パフォチューン
- [ ] **100** README / wiki 更新

### バックエンド (101‑200)
#### 4.1 初期化 (101‑110)
- [ ] **101** apps/backend 生成
- [ ] **102** `npm init -y`
- [ ] **103** TypeScript, ESLint, Prettier 設定
- [ ] **104** Express & ts-node-dev
- [ ] **105** tsconfig
- [ ] **106** 開発サーバースクリプト
- [ ] **107** commit `feat(backend): init`
- [ ] **108** .env.example 追加
- [ ] **109** API 方針ドキュメント
- [ ] **110** "Hello from Backend" ルート

#### 4.2 DB & マイグレーション (111‑120)
- [ ] **111** Supabase プロジェクト作成
- [ ] **112** `@supabase/supabase-js` 導入
- [ ] **113** Prisma schema → `supabase db push`
- [ ] **114** users / projects / tasks 他テーブル
- [ ] **115** RLS ポリシー auth.uid() 制限
- [ ] **116** 外部キー & Index
- [ ] **117** `supabase/migrations` コミット
- [ ] **118** 接続テスト
- [ ] **119** トランザクション方針
- [ ] **120** commit `chore(backend): db schema`

#### 4.3 ルーティング & 認証 (121‑140)
- [ ] **121** `src/routes/index.ts` Router
- [ ] **122** `/api/v1/users` CRUD
- [ ] **123** `/api/v1/projects` CRUD
- [ ] **124** Zod バリデーション MW
- [ ] **125** GET `/projects` 実装
- [ ] **126** POST `/projects` 実装
- [ ] **127** GET `/tasks` 実装
- [ ] **128** 共通 ErrorHandler JSON
- [ ] **129** commit `feat(backend): basic routes` (2025-04-27)
- [ ] **130** CORS & morgan ログ
- [ ] **131** JWT ミドルウェア
- [ ] **132** POST `/auth/login`
- [ ] **133** POST `/auth/signup`
- [ ] **134** `/auth/logout`
- [ ] **135** オーナーチェック MW
- [ ] **136** 役割ベース guard
- [ ] **137** 401/403 共通レスポンス
- [ ] **138** 認証 E2E テスト
- [ ] **139** commit `feat(backend): auth`
- [ ] **140** 認証テスト pass

#### 4.4 CRUD & AI API (141‑170)
- [ ] **141** projectController 実装
- [ ] **142** taskService 実装
- [ ] **143** createProject(userId, data)
- [ ] **144** controller ↔ service 分離 (2025-04-25)
- [ ] **145** GET `/projects` (owner only) (2025-04-25)
- [ ] **146** PUT `/tasks/:id` (2025-04-25)
- [ ] **147** try‑catch → ErrorHandler (2025-04-25)
- [ ] **148** 所有権チェック (2025-04-25)
- [ ] **149** commit `feat(backend): controllers` (2025-04-25)
- [ ] **150** Service ユニットテスト (2025-04-25)
- [ ] **151** POST `/ai/coach` (OpenAI)
- [ ] **152** ユーザー別モデル設定取得
- [ ] **153** OpenAI API 呼び出し
- [ ] **154** タスク分解 API
- [ ] **155** redis‑rate‑limit
- [x] **156** OpenAI エラーリトライ
- [x] **157** ai_messages テーブル保存
- [x] **158** レスポンスフォーマット確定
- [x] **159** commit `feat(backend): ai endpoints`
- [x] **160** AI API テスト

#### 4.5 テスト・デプロイ・運用 (171‑200)
- [ ] **171** Supertest 統合テスト雛形 (2025-04-25)
- [ ] **172** 認証フロー統合テスト (2025-04-25)
- [ ] **173** CRUD 正常/異常系テスト (2025-04-25)
- [ ] **174** AI API モックテスト (2025-04-25)
- [ ] **175** 共通レスポンス型テスト (2025-04-25)
- [ ] **176** Jest カバレッジ >85% (2025-04-25)
- [ ] **177** pino ロガー導入 (2025-04-25)
- [ ] **178** DB 例外 & 未知例外ハンドリング (2025-04-25)
- [ ] **179** commit `test(backend): coverage` (2025-04-25)
- [ ] **180** コードリファクタリング (2025-04-27)
- [ ] **181** Dockerfile (multi‑stage)
- [ ] **182** GitHub Actions: Docker build & push
- [ ] **183** Fly.io app 作成 & Secrets 登録
- [ ] **184** fly deploy
- [ ] **185** Supabase Realtime 設定 (任意)
- [ ] **186** ヘルスチェックエンドポイント (2025-04-27)
- [ ] **187** CloudWatch / Logtail 等監視
- [ ] **188** UptimeRobot 監視設定
- [ ] **189** commit `build(backend): deploy config`
- [ ] **190** 環境差分 (dev/stg/prod) 設定
- [ ] **191** Datadog/Sentry APM
- [ ] **192** DB バックアップスケジュール
- [ ] **193** npm 依存アップデートフロー
- [ ] **194** SLA / 障害対応手順書
- [ ] **195** 新機能影響調査テンプレ
- [ ] **196** コード & スキーマ定期リファクタ
- [ ] **197** データアーカイブ & レポート
- [ ] **198** レトロスペクティブ実施
- [ ] **199** commit `chore(backend): ops docs`
- [ ] **200** プロジェクト総括 & 次期ロードマップ策定
```

</details>

---

## 4. AIアシスタントとの協業フロー

### 4.1 要件定義フェーズ
1. **要件文書の作成・更新**:
   - 各機能の詳細仕様をYAMLフロントマターで定義
   - 要件変更時は必ずドキュメントを先に更新
   - AIアシスタントに要件の一貫性チェックを依頼

2. **API仕様の明確化**:
   - OpenAPI仕様書を先に完成させる
   - エンドポイント、リクエスト/レスポンス形式を明確に定義
   - 認証・認可の仕組みを文書化

### 4.2 開発フェーズのAI協業
1. **役割分担**:
   - **AIアシスタント**: コード生成、ユニットテスト作成、PR準備
   - **人間開発者**: コードレビュー、複雑な設計判断、最終承認

2. **実装サイクル**:
   - 小さな機能単位で実装→テスト→コミット
   - 各機能完了後に `scratchpad.md` に進捗を記録
   - テストカバレッジを維持（85%以上）
   - AI会話は1タスク = 1会話セッションの原則を守る

3. **効率的なコード生成**:
   - 明確な指示と十分なコンテキストをAIに提供
   - 大きなファイルの編集は小さな単位で行う
   - 複雑なロジックは人間が設計し、AIが実装

### 4.3 テストフェーズのAI協業
1. **テスト戦略**:
   - AIがテストケース生成と回帰テストを担当
   - 人間はエッジケースの特定と複雑なシナリオテストを担当

2. **品質保証プロセス**:
   - 自動テストを優先的に作成・実行
   - コードレビューとテスト結果の人間による最終確認
   - バグ修正はAIと人間の共同作業

### 4.4 リリースプロセス
1. **マージ前チェック**:
   - 各PRは仕様との整合性確認
   - 自動テストの実行と結果確認
   - 人間による最終承認

2. **デプロイ準備**:
   - 環境変数の整備
   - Docker化とFly.ioへのデプロイ設定

### 4.5 AI使用量最適化
1. **会話管理**:
   - 会話を短く区切る（1つのタスクごとに会話をリセット）
   - 会話履歴は別ファイルに分割して保存

2. **リソース効率化**:
   - 大きなファイルの全体表示を避け、必要な部分だけを表示
   - 複雑なタスクは明確に分割して実行
   - 長時間の会話を避け、定期的にセッションをリセット

## 5. チェックリストとガイドライン

### 5.1 PR作成チェックリスト
- [ ] 関連する仕様書へのリンクを含める
- [ ] type/bug または type/feature ラベルを設定
- [ ] acceptance criteriaを満たしていることを確認
- [ ] definition of doneを満たしていることを確認

### 5.2 リスク管理
| リスク | 影響度 | 対策 |
|---------|---------|-------|
| AI精度問題 | 高 | ステージング環境での人間によるレビューゲート |
| スケジュール遅延 | 中 | 優先順位を明確にし、随時見直す |
| スコープクリープ | 中 | 要件変更管理プロセスの引き签を取る |
| 技術的負債の表面化 | 中 | スクラッチパッドで対応計画を管理、リリース前に解消 |

### 5.3 技術的負債対応タスク

#### ESLint警告・エラー管理
バックエンドに残っているESLint警告（28件）とエラー（21件）については、以下のアプローチで対応します：

1. **認識しておく（TODOとして記録）**
   - [x] 現在の警告・エラーを文書化 (2025-04-27)
   - [ ] それぞれのカテゴリ分けと対応优先度を決定
   - [ ] 次回の大きなリファクタリングで対応する計画立案

2. **重要度の高いものだけ修正**
   - [ ] セキュリティに関わる警告・エラーの優先対応
   - [ ] パフォーマンスに大きく影響する問題の修正
   - [ ] 実行時エラーを引き起こす可能性が高い問題の修正

3. **最終リリース前には対応**
   - [ ] プロダクションデプロイ前に全ての警告・エラーを解決
   - [ ] 特に型安全性に関わる問題の解決
   - [ ] ESLint設定の見直しと最適化


## 6. 改訂履歴
| Ver | 日付 | 変更概要 | 編集者 |
|-----|------|----------|--------|
| 6.0 | 2025‑04‑27 | AIアシスタントとの協業フロー追加、チェックリストとリスク管理セクション追加 | Cascade |
| 5.0 | 2025‑04‑25 | フロントエンド進捗リセット、AI使用量最適化セクション追加、バックエンド優先開発の強化 | Windsurf |
| 4.0 | 2025‑04‑25 | 開発環境変更（Windsurfのみ使用）に対応した新開発フロー導入、バックエンド優先アプローチの詳細化 | Windsurf |
| 3.0 | 2025‑04‑22 | docs を全面再生成。フロント dnd‑kit & 分離型構成を正式反映、200 Step を完備 | ChatGPT |

## 7. テスト生成・確認ロードマップ

### 7.1 テスト生成の基本方針

#### 段階的アプローチ
1. **単体テストから着手**
   - コンポーネント単位のテスト
   - フック単位のテスト
   - ユーティリティ関数のテスト

2. **統合テストの追加**
   - コンポーネント間の連携
   - データフローの確認
   - API連携の確認

3. **E2Eテストの実装**
   - ユースケースのテスト
   - エッジケースのテスト
   - パフォーマンステスト

### 7.2 テスト生成手順

#### 準備フェーズ
- [ ] テスト対象の特定
- [ ] コンポーネントの責務確認
- [ ] 入力/出力の仕様確認
- [ ] エッジケースの洗い出し
- [ ] テスト環境の整備
- [ ] Jest/RTLの設定確認
- [ ] モックの準備
- [ ] テストヘルパーの作成

#### テスト生成フェーズ
- [ ] 基本テストケースの生成
  - [ ] レンダリングテスト
  - [ ] イベントハンドリングテスト
  - [ ] 状態変更テスト
- [ ] エッジケースのテスト生成
  - [ ] 異常値のテスト
  - [ ] エラーハンドリングのテスト
  - [ ] 境界値のテスト

#### テスト実行・確認フェーズ
- [ ] テストの実行
  - [ ] 単体テストの実行
  - [ ] 統合テストの実行
  - [ ] E2Eテストの実行
- [ ] 結果の確認
  - [ ] テストカバレッジの確認
  - [ ] 失敗したテストの分析
  - [ ] 必要に応じた修正

### 7.3 優先順位付きテスト実装計画

#### 高優先度（Step 30-40）
- [ ] 認証フローのテスト（Step 30）
  - [ ] ログインフォームのテスト
  - [ ] 認証状態のテスト
  - [ ] エラーハンドリングのテスト
- [ ] ダッシュボードのテスト（Step 39）
  - [ ] レイアウトのテスト
  - [ ] データ表示のテスト
  - [ ] インタラクションのテスト
- [ ] コンポーネントのテスト（Step 40）
  - [ ] カンバンボードのテスト（2025-05-01）
  - [ ] タスクカードのテスト（2025-05-01）
  - [ ] プロジェクト一覧のテスト

#### 中優先度（Step 44-60）
- [ ] RTL + Cypressテスト（Step 44）
  - [ ] 統合テストの追加
  - [ ] E2Eテストの実装
  - [ ] パフォーマンステスト
- [ ] プロジェクト詳細ページのテスト（Step 60.2）
  - [ ] レイアウトのテスト
  - [ ] データ表示のテスト
  - [ ] インタラクションのテスト

#### 低優先度（Step 81-90）
- [ ] Jest単体テスト（Step 81）
  - [ ] カバレッジ80%以上
  - [ ] エッジケースのテスト
  - [ ] パフォーマンステスト
- [ ] Storybookドキュメント（Step 90）
  - [ ] コンポーネントのドキュメント化
  - [ ] インタラクションの記録
  - [ ] テストケースの文書化

### 7.4 テスト確認チェックリスト

#### テスト品質チェック
- [ ] テストの意図が明確か
- [ ] エッジケースが網羅されているか
- [ ] テストの独立性が保たれているか
- [ ] モックが適切に使用されているか
- [ ] テストの実行時間が適切か

#### コード品質チェック
- [ ] テストコードの可読性
- [ ] テストの保守性
- [ ] テストの再利用性
- [ ] テストの拡張性

#### カバレッジチェック
- [ ] ステートメントカバレッジ
- [ ] ブランチカバレッジ
- [ ] 関数カバレッジ
- [ ] 行カバレッジ

### 7.5 進捗管理

#### 日次チェック
- [ ] テストの実行結果確認
- [ ] カバレッジの確認
- [ ] 失敗したテストの修正

#### 週次チェック
- [ ] 進捗状況の確認
- [ ] 優先順位の見直し
- [ ] リスクの再評価

#### 月次チェック
- [ ] 全体の進捗確認
- [ ] 品質指標の確認
- [ ] 計画の見直し

## 8. 3プレーヤーの役割分担ロードマップ

### 8.1 o3（アーキテクチャ設計・品質保証）

#### フェーズ1：基盤構築（Step 0-20）
- [ ] **0-5** モノレポ構成の設計と設定
- [ ] **6-10** 共有ツールの選定と設定
- [ ] **11-15** 開発環境の標準化
- [ ] **16-20** プロジェクト管理基盤の整備

#### フェーズ2：フロントエンド設計（Step 21-40）
- [ ] **21-25** 認証フローの設計
- [ ] **26-30** ダッシュボードのアーキテクチャ設計
- [ ] **31-35** コンポーネント設計原則の確立
- [ ] **36-40** テスト戦略の策定

#### フェーズ3：コア機能設計（Step 41-60）
- [ ] **41-45** カンバンボードの設計
- [ ] **46-50** プロジェクト管理の設計
- [ ] **51-55** タスク管理の設計
- [ ] **56-60** AI連携の設計

#### フェーズ4：品質保証（Step 81-100）
- [ ] **81-85** テストカバレッジの監視
- [ ] **86-90** パフォーマンス最適化
- [ ] **91-95** アクセシビリティ検証
- [ ] **96-100** セキュリティ監査

### 8.2 cursor（コード実装・機能開発）

#### フェーズ1：認証実装（Step 21-30）
- [ ] **21-25** ログイン/ログアウト機能
- [ ] **26-30** ユーザー登録/パスワードリセット

#### フェーズ2：ダッシュボード実装（Step 31-40）
- [ ] **31-35** レイアウトとコンポーネント
- [ ] **36-40** データ表示とインタラクション

#### フェーズ3：カンバン実装（Step 41-60）
- [ ] **41-45** ドラッグ&ドロップ機能
- [ ] **46-50** タスク管理機能
- [ ] **51-55** プロジェクト管理機能
- [ ] **56-60** AI連携機能

#### フェーズ4：テスト実装（Step 81-90）
- [ ] **81-85** 単体テスト
- [ ] **86-90** 統合テスト
- [ ] **91-95** E2Eテスト
- [ ] **96-100** パフォーマンステスト

### 8.3 windsurf（統合・CI/CD・運用）

#### フェーズ1：環境構築（Step 0-20）
- [ ] **0-5** 開発環境のセットアップ
- [ ] **6-10** ビルド設定の整備
- [ ] **11-15** テスト環境の準備
- [ ] **16-20** CI/CDパイプラインの構築

#### フェーズ2：統合（Step 61-80）
- [ ] **61-65** フロントエンド・バックエンド連携
- [ ] **66-70** データ同期の実装
- [ ] **71-75** エラーハンドリング
- [ ] **76-80** ログ管理

#### フェーズ3：デプロイ（Step 181-190）
- [ ] **181-185** Docker化
- [ ] **186-190** 本番環境デプロイ

#### フェーズ4：運用（Step 191-200）
- [ ] **191-195** モニタリング設定
- [ ] **196-200** 運用ドキュメント整備

---

# CI/CDパイプライン設定ガイド

## 概要

このドキュメントでは、Commit Coachプロジェクトで使用するCI/CDパイプラインの設定方法について説明します。CI/CDパイプラインは、コードの品質保証、テスト自動化、デプロイの自動化を実現するために重要な役割を果たします。

## 設定済みワークフロー

以下のGitHub Actionsワークフローが設定されています：

1. **CI** (`ci.yml`)
   - リントとタイプチェック
   - ビルドテスト
   - セキュリティスキャン

2. **テストスイート** (`test-suite.yml`)
   - ユニットテスト
   - 統合テスト
   - E2Eテスト
   - カバレッジレポート

3. **バックエンドデプロイ** (`backend-deploy.yml`)
   - テスト実行
   - Fly.ioへのデプロイ

4. **フロントエンドデプロイ** (`frontend-deploy.yml`)
   - テスト実行
   - プレビューデプロイ（PR時）
   - 本番デプロイ（mainブランチへのマージ時）

## 必要なシークレット設定

GitHub Actionsワークフローを正常に実行するためには、以下のシークレットをGitHubリポジトリに設定する必要があります：

### Codecov連携用

- `CODECOV_TOKEN`: Codecovからのトークン（テストカバレッジレポート用）

### Vercel連携用（フロントエンド）

- `VERCEL_TOKEN`: Vercel CLIのトークン
- `VERCEL_ORG_ID`: VercelのOrganization ID
- `VERCEL_PROJECT_ID`: VercelのProject ID

### Fly.io連携用（バックエンド）

- `FLY_API_TOKEN`: Fly.io APIトークン

## シークレットの設定方法

1. GitHubリポジトリの「Settings」タブに移動
2. 左側のメニューから「Secrets and variables」→「Actions」を選択
3. 「New repository secret」ボタンをクリック
4. 名前（例：`VERCEL_TOKEN`）と値を入力して保存

## デプロイ設定

### Vercel（フロントエンド）

1. Vercelアカウントにログイン
2. 新しいプロジェクトを作成
3. 以下の設定を行う：
   - Framework Preset: Next.js
   - Root Directory: apps/frontend
   - Build Command: pnpm build
   - Output Directory: .next

### Fly.io（バックエンド）

1. Fly.ioアカウントにログイン
2. 新しいアプリケーションを作成
3. 以下の設定を行う：
   - Dockerfile: apps/backend/Dockerfile
   - Configuration: apps/backend/fly.toml

## ローカル開発での使用方法

Turborepoを使用して、以下のコマンドでローカル開発を行うことができます：

```bash
# 開発サーバーの起動
pnpm dev

# ビルド
pnpm build

# テスト実行
pnpm test

# リント実行
pnpm lint

# クリーンアップ
pnpm clean
```

## CI/CDパイプラインの拡張

新しいワークフローを追加する場合は、`.github/workflows/`ディレクトリに新しいYAMLファイルを作成します。既存のワークフローをテンプレートとして使用することができます。

## トラブルシューティング

### よくある問題と解決策

1. **ビルドエラー**
   - package.jsonの依存関係が最新かどうか確認
   - node_modulesを削除して再インストール

2. **テスト失敗**
   - テストが最新のコードと一致しているか確認
   - モックの設定を確認

3. **デプロイ失敗**
   - シークレットが正しく設定されているか確認
   - デプロイ設定（Vercel/Fly.io）を確認

## 参考リンク

- [GitHub Actions ドキュメント](https://docs.github.com/ja/actions)
- [Vercel デプロイドキュメント](https://vercel.com/docs/deployments/overview)
- [Fly.io デプロイドキュメント](https://fly.io/docs/hands-on/install-flyctl/)
- [Turborepo ドキュメント](https://turbo.build/repo/docs)

---

# 既知の課題・技術的制約

### 1. SupabaseのRLS制約
- RLS（Row Level Security）を有効化しているため、API経由でのデータ取得・更新時に認証トークンが必須。
- テスト時はRLSを一時的に無効化するか、テスト用ユーザーで実行する必要あり。

### 2. Next.js App RouterのSSR制約
- App RouterでServer Componentとして解釈されると、`document`や`window`参照でクラッシュする。
- クライアント専用ロジックは必ず`'use client'`ディレクティブを付与。

### 3. Babel/SWC競合
- Babel設定ファイルが存在するとNext.jsがSWCからBabelにフォールバックし、`next/font`等の一部機能が動作しなくなる。
- Babelが必要な場合はStorybook/Jest等の個別設定に限定。

### 4. Supabaseの型定義とZodスキーマの乖離
- DBスキーマ変更時、`packages/shared-types`のZodスキーマも必ず更新。
- 型の不整合によるバグが発生しやすい。

### 5. CI/CDのSecrets管理
- GitHub ActionsのSecretsが未設定だとデプロイ・テストが失敗する。
- 新規環境構築時はREADME/CIガイドを必ず参照。

### 6. Fly.ioの無料枠制限
- 無料枠のCPU/メモリ制限により、バックエンドの一時停止やデプロイ失敗が発生する場合あり。
- 商用運用時は有料プラン推奨。

### 7. Vercelのビルドキャッシュ問題
- Vercelのキャッシュが壊れると、デプロイが失敗することがある。
- キャッシュクリアや再デプロイで解消可能。

### 8. その他
- 一部のnpmパッケージが非推奨・deprecatedになっている場合がある。定期的な依存アップデート推奨。
- テスト用のダミーデータが本番に混入しないよう注意。
