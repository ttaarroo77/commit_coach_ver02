# Next.js 環境変数（.env.local）読み込み問題レポート

## 1. 今の問題点

- `apps/frontend/.env.local` が存在しているにもかかわらず、Next.js（`process.env.NEXT_PUBLIC_SUPABASE_URL` など）から値が `undefined` となり、Supabaseクライアントの初期化でエラーが発生している。
- サーバー起動時のターミナルログにも `SUPABASE_URL: undefined` と表示されている。

## 2. 解決に必要と思われるファイル群

- `apps/frontend/.env.local`（環境変数定義ファイル）
- `apps/frontend/src/contexts/AuthProvider.tsx`（環境変数の利用・console.log確認用）
- `apps/frontend/package.json`（Next.jsのバージョン確認用）
- `apps/frontend/next.config.mjs`（Next.jsの設定確認用）

## 3. cat コマンドで中身を見る方法

```sh
# .env.local の中身を確認
cat apps/frontend/.env.local

# AuthProvider.tsx の先頭数行を確認
head -20 apps/frontend/src/contexts/AuthProvider.tsx

# package.json の中身を確認
cat apps/frontend/package.json

# next.config.mjs の中身を確認
cat apps/frontend/next.config.mjs
```

## 4. 想定される原因と解決策（複数）

### 原因1：.env.local の書式ミス
- **イコールの前後にスペースがある**と読み込まれない。
- **解決策**：
  - `NEXT_PUBLIC_SUPABASE_URL=https://xxxx.supabase.co` のように、イコールの前後にスペースを入れない。

### 原因2：.env.local の文字コード・改行コード
- **文字コードがUTF-8以外**、または**改行コードがCRLF**だと読み込まれない場合がある。
- **解決策**：
  - VSCode等で「UTF-8」「LF」に統一。

### 原因3：.env.local のパーミッション
- **ファイルの読み取り権限がない**場合、読み込まれない。
- **解決策**：
  - `chmod 644 apps/frontend/.env.local` で権限を付与。

### 原因4：Next.jsのキャッシュ
- **キャッシュが古い場合**、環境変数が反映されないことがある。
- **解決策**：
  - `rm -rf .next` でキャッシュ削除後、`pnpm dev` で再起動。

### 原因5：ファイルの配置場所
- **`apps/frontend/.env.local` 以外の場所に置いている**と読み込まれない。
- **解決策**：
  - 必ず `apps/frontend/.env.local` に配置。

### 原因6：Next.jsのバージョンや設定
- **バージョンや設定による仕様変更**の可能性。
- **解決策**：
  - `package.json` でバージョン確認、`next.config.mjs` の設定も見直す。

---

## 5. 追加で確認・報告してほしいこと
- `.env.local` の内容（値は伏せ字でOK）
- `ls -a apps/frontend` の結果
- `cat apps/frontend/.env.local` の結果
- サーバー起動時の `console.log` の出力結果

---

このレポートをもとに、原因の切り分けと解決を進めてください。